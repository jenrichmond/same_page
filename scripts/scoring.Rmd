---
title: "scoring"
author: "Jen Richmond"
date: "01/06/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# load packages

```{r message=FALSE, warning=FALSE}
library(tidyverse)
```


# create fake data

Use c() to make vectors of TRUE/FALSE (NOTE I think the code below would work the same if the values were 1, 0)

```{r}
# low items
low1 <- c(T, T, T, T, F, F, T, F, T, F, T, T)
low2 <- c(T, F, T, T, T, T, F, T, T, T, T, T)
low3 <- c(F, T, T, T, F, T, T, F, F, T, T, T)

# column bind
low <- cbind(low1, low2, low3)

# med items
med1 <- c(T, T, F, F, F, T, F, F, F, F, F, F)
med2 <- c(T, F, T, T, T, F, F, T, F, F, F, F)
med3 <- c(T, F, T, F, T, T, F, T, F, T, F, T)
med4 <- c(T, F, T, F, F, T, F, F, T, F, F, T)
med5 <- c(T, F, T, T, T, F, F, T, F, F, F, F)
med6 <- c(F, F, F, F, F, F, F, F, F, F, F, F)

# column bind
med <- cbind(med1, med2, med3, med4, med5, med6)

#high items

high1 <- c(F, F, F, F, T, F, T, F, F, F, F, F)
high2 <- c(T, F, F, F, F, T, F, F, F, F, F, F)

 # column bind
high <- cbind(high1, high2)

```

Bind low, med, high together and convert to a dataframe, add paperid. 
```{r}
all <- cbind(low, med, high) # this creates a "matrix", convert to dataframe

all<- as.data.frame(all)

# add paper id

all <- all %>%
  mutate(paperid = row_number()) %>%
  relocate(paperid, .before = low1)

glimpse(all)
```

# scoring

low items = 1
med items = 2
high items = 5

## make data long

Pull wide data into two columns, one with the names of each item, and one with the T/F (yesno, 1,0) values in it. 
```{r}
all_long <- all %>%
  pivot_longer(names_to = "item", values_to = "yesno", low1:high2)

glimpse(all_long)
```

## new score column

Use mutate to make a new column called score that gives 0 when the yes/no value is FALSE and scores of 1 for low items that are TRUE, 2 for med items that are TRUE, and 5 for high items that are TRUE. 


```{r}
all_scored <- all_long %>%
  mutate(score = case_when(yesno == FALSE ~ 0, 
                            item == "low1" & yesno == "TRUE" ~ 1,
                           item == "low2" & yesno == "TRUE" ~ 1,
                           item == "low3" & yesno == "TRUE" ~ 1,
                           item == "med1" & yesno == "TRUE" ~ 2,
                           item == "med2" & yesno == "TRUE" ~ 2, 
                           item == "med3" & yesno == "TRUE" ~ 2,
                           item == "med4" & yesno == "TRUE" ~ 2,
                           item == "med5" & yesno == "TRUE" ~ 2,
                           item == "med6" & yesno == "TRUE" ~ 2,
                           item == "high1" & yesno == "TRUE" ~ 5,
                           item == "high2" & yesno == "TRUE" ~ 5))

glimpse(all_scored)

```

# group_by paper, summarise score

Use group_by and summarise to add up the score for each paper individually. Add gt::gt() to get it to display in a nice table. 

```{r}
all_scored %>%
  group_by(paperid) %>%
  summarise(totalscore = sum(score)) %>%
  gt::gt()
```

# more complicated example 

## more realistic data
```{r}

med1X <- c("yes", "no", "yes", "no", "yes", "yes", "no", "yes", "no", "yes", "no", "yes")


med2X <- c("public dataset generated by authors", "Other (please specify)", "public dataset generated by authors", "Other (please specify)", "Not clear", "public dataset generated by authors", "Not clear", "public dataset generated by others", "Not clear", "Not clear", "public dataset generated by others", "Not clear")
med3X <- c("Independent archive/repository","Independent archive/repository","Independent archive/repository","Independent archive/repository","Independent archive/repository", "Other (please specify):", "Other (please specify):","Independent archive/repository","Independent archive/repository", "Other (please specify):", "Other (please specify):", "Independent archive/repository")

med <- cbind(med1X, med2X, med3X)

med <- as.data.frame(med)

med <- med %>%
  mutate(paperID = row_number())  %>%
  relocate(paperID, .before = med1X)
```

## make datalong
```{r}
med_long <- med %>%
  pivot_longer(names_to = "item", values_to = "yesno", med1X:med3X)

glimpse(med_long)

```

## new score column

OK this is a more complicated case_when. If yes/no is FALSE then make the score 0, if the items is med1X (or med3X) and yesno is TRUE, make the score 2. 
For item med2X, if yesno == NOt clear, make the score 0. If yesno is an item in (ie. %in%) the list of "public dataset generated by authors", "Other (please specify)", "public dataset generated by others", then the score should be 2. 


```{r}
medXscored <- med_long %>%
  mutate(score = case_when(yesno == "FALSE" ~ 0, 
                            item == "med1X" & yesno == "TRUE" ~ 2,
                           item == "med3X" & yesno == "TRUE" ~ 2,
                          item == "med2X" & yesno == "Not clear" ~ 0, 
        item == "med2X" & yesno %in% c("public dataset generated by authors", "Other (please specify)", "public dataset generated by others") ~ 2))
                           

glimpse(medXscored)
```

```{r}

medXscored %>%
  group_by(paperID) %>%
  summarise(totalscore = sum(score)) %>%
  gt::gt()
```


# more realistic example

```{r}
x <- read_csv("examplestoscore.csv")

x <- x %>%
  rename(q14_gen = q14, q16_repo = q16, q19_perm = q19)

x_longer <- x %>%
  pivot_longer(names_to = "question", values_to = "response", q14_gen:q19_perm)

x_scored <- x_longer %>%
  mutate(score = case_when(question == "q14_gen" & response %in% c("Public dataset generated by the authors", "Public dataset generated by others") ~ 2,
                           question == "q14_gen" & response == "Not clear" ~ 0,
                           question == "q16_repo" & response == "Independent archive/repository" ~ 2,
                           question == "q16_repo" & response == "Other (please specify):" ~ 2,
                            question == "q19_perm" & response == "Yes" ~ 2,
                           question == "q19_perm" & response == "Requires permission" ~ 0, 
                          is.na(response) ~ 0)) 
                          
score_summary <- x_scored %>%
  group_by(q4_1) %>% 
  summarise(totalscore = sum(score))
                            
                          
```

