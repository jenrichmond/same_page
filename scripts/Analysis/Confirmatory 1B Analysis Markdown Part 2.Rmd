---
title: "Confirmatory 1B Analysis Markdown Part 2"
output:
  html_document: default
  word_document: default
---
# PREPARATION

## Load Packages
```{r message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
library(extrafont)
library(here)
library(ggeasy)
library(rstatix)
library(apa)
library(ez)
library(afex)
library(papaja)
library(patchwork)
library(jmv)
```

## Read in 1B data
```{r message=FALSE, warning=FALSE, include=FALSE}
options(scipen=999) # remove scientific notation

data1B <- read_csv(here("data_files", "scored_master_dataset_1B.csv"))
```

## Select only relevant 1B data 

```{r include=FALSE}
data1Bselect <- data1B %>%
  select(article_id_number, subfield, total_data_score, total_materials_score)
```

## Read in 1A data

```{r message=FALSE, warning=FALSE, include=FALSE}
data1A <- read_csv(here("data_files", "scored_master_dataset_1A.csv"))
```

## Select only relevant 1A data

```{r include=FALSE}
data1Aselect <- data1A %>%
  select(article_id_number, subfield, total_data_score, total_materials_score)
```

## Merge 1A and 1B data into one dataframe

```{r include=FALSE}
alldata <- rbind(data1Aselect, data1Bselect)
```

## First factor: Subfield 

```{r echo=FALSE}
# let's let's collapse the subfields into 4 main groups: developmental, cognition, social and 'other'
subfield_groups <- alldata %>%
  mutate(subfield_groups = case_when(subfield == "Behavioural Neuroscience" ~ "Other",
                                     subfield == "Cognitive Neuroscience" ~ "Other",
                                     subfield == "Health Psychology" ~ "Other",
                                     subfield == "Perception" ~ "Other",
                                     subfield == "Developmental Psychology" ~ "Development",
                                     subfield == "Social Psychology" ~  "Social",
                                     TRUE ~ as.character(subfield))) %>%
  relocate(subfield_groups, .after = subfield)

# we can now delete the original subfield column
subfield_groups <- subfield_groups %>%
  select(-subfield)

# Subfield summary

subfield_summary <- subfield_groups %>%
    count(subfield_groups) 

subfield_summary
```

## Second factor: Time period

```{r echo=FALSE}
dates <- subfield_groups %>%
  mutate(time_period = case_when(
    str_detect(article_id_number, "1-2014|2-2014|3-2014|4-2014|5-2014|6-2014|7-2014|8-2014|9-2014|10-2014|11-2014|12-2014|1-2015|2-2015|3-2015|4-2015|5-2015") ~ "2014-15",
    str_detect(article_id_number, "2019-30-7|2019-30-8|2019-30-9|2019-30-10|2019-30-11|2019-30-12|2020-31-1|2020-31-2|2020-31-3|2020-31-4|2020-31-5|2020-31-6|2020-31-7|2020-31-8|2020-31-9|2020-31-10|2020-31-11|2020-31-12") ~ "2019-20")) %>%
  relocate(time_period, .after = article_id_number)

# make sure subfield and timeperiod are factors 

dates$subfield_groups <- fct_relevel(dates$subfield_groups, c("Development", "Social", "Cognition", "Other"))
dates$time_period <- fct_relevel(dates$time_period, c("2014-15", "2019-20"))

levels(dates$time_period)

# Timeperiod summary

timeperiod_summary <- dates %>%
  count(time_period)

timeperiod_summary
```

# DATA ANOVA

```{r echo=FALSE}
data_ANOVA <- dates %>%
  anova_test(total_data_score ~ subfield_groups * time_period)

data_ANOVA
```

Our two-way between-subjects ANOVA generated a significant main effect of subfield, F(`r data_ANOVA$DFn[1]`, `r data_ANOVA$DFd[1]`) = `r data_ANOVA$F[1]`, p = `r data_ANOVA$p[1]`, ges = `r data_ANOVA$ges[1]`, and time period, F(`r data_ANOVA$DFn[2]`, `r data_ANOVA$DFd[2]`) = `r data_ANOVA$F[2]`, p = `r data_ANOVA$p[2]`, ges = `r data_ANOVA$ges[2]`. However, the interaction between subfield and time period, F(`r data_ANOVA$DFn[3]`, `r data_ANOVA$DFd[3]`) = `r data_ANOVA$F[3]`, ges = `r data_ANOVA$ges[3]`, was not statistically significant.

```{r echo=FALSE, message=FALSE}
# Alternatively we can use the papaja package to print the stats: 

data_aov <- aov_ez(
  data = dates, dv = "total_data_score", 
  id = "article_id_number", 
  between = c("time_period", "subfield_groups"), 
  type = "2")

data_aov$anova_table

data_apa <- apa_print(data_aov)

apa_table(data_apa$table,
          caption = "Between-subjects ANOVA for Open Data Scores", 
          note = "This table was created with apa_table().")
```

Our two-way between-subjects ANOVA generated a significant main effect of time period, `r data_apa$full$time_period`, and a significant main effect of subfield, `r data_apa$full$subfield_groups`. However, the interaction between time period and subfield, `r data_apa$full$time_period_subfield_groups`, was not statistically significant. 

# MATERIALS ANOVA Analysis 

```{r echo=FALSE}
materials_ANOVA <- dates %>%
  anova_test(total_materials_score ~ subfield_groups * time_period)

materials_ANOVA
```

Our two-way between-subjects ANOVA generated a significant main effect of subfield, F(`r materials_ANOVA$DFn[1]`, `r materials_ANOVA$DFd[1]`) = `r materials_ANOVA$F[1]`, p = `r materials_ANOVA$p[1]`, ges = `r materials_ANOVA$ges[1]`, and time period, F(`r materials_ANOVA$DFn[2]`, `r materials_ANOVA$DFd[2]`) = `r materials_ANOVA$F[2]`, p = `r materials_ANOVA$p[2]`, ges = `r materials_ANOVA$ges[2]`. However, the interaction between subfield and time period, F(`r materials_ANOVA$DFn[3]`, `r materials_ANOVA$DFd[3]`) = `r materials_ANOVA$F[3]`, ges = `r materials_ANOVA$ges[3]`, was not statistically significant.

```{r echo=FALSE}
# Alternatively we can use the papaja package to print the stats: 

materials_aov <- aov_ez(
  data = dates, dv = "total_materials_score", 
  id = "article_id_number", 
  between = c("time_period", "subfield_groups"), 
  type = "2")

materials_aov$anova_table

materials_apa <- apa_print(materials_aov)

apa_table(materials_apa$table,
          caption = "Between-subjects ANOVA for Open Materials Scores", 
          note = "This table was created with apa_table().")
```

Our two-way between-subjects ANOVA generated a significant main effect of subfield, `r materials_apa$full$subfield_groups`, and time period, `r materials_apa$full$time_period`. However, the interaction between time period and subfield, `r materials_apa$full$time_period_subfield_groups`, was not statistically significant. 

# PLOTS

## DATA

### Subfield x Data Score

```{r echo=FALSE}
data_subfield_descriptives <- dates %>%
  group_by(subfield_groups) %>%
  summarise(mean_data_score = mean(total_data_score, na.rm = TRUE),
            SD = sd(total_data_score, na.rm = TRUE),
            N = n(),
            stderr = SD/sqrt(N))

data_subfield_descriptives

# let's plot this

d1 <- data_subfield_descriptives %>%
  ggplot(aes(x = reorder(subfield_groups, mean_data_score), y = mean_data_score, fill = subfield_groups)) +
  geom_col() +
  geom_errorbar(aes(ymin = mean_data_score - stderr, ymax = mean_data_score + stderr), # specifying what the standard error is
                size=.3, # thinner lines
                width=.2) + # narrower bars
    theme_classic() +
    scale_fill_manual(values=c("#FF6666","#6699CC", "#FFCC33", "#00CC99")) +
  scale_y_continuous(limits = c(0,25), expand = c(0,0)) + # getting the bars to start at the bottom of the graph
  easy_remove_legend() +
  easy_all_text_size(size = 8) + # change the size of the text
  easy_labs(x = "Subfield", y = "Mean Open Data Score") + # change the x and y labels
  ggtitle('(a)')

```

### Time Period x Data Score

```{r echo=FALSE}
data_timeperiod_descriptives <- dates %>%
  group_by(time_period) %>%
  summarise(mean_data_score = mean(total_data_score, na.rm = TRUE),
            SD = sd(total_data_score, na.rm = TRUE),
            N = n(),
            stderr = SD/sqrt(N))

data_timeperiod_descriptives

# let's plot this

d2 <- data_timeperiod_descriptives %>%
  ggplot(aes(x = time_period, y = mean_data_score, fill = time_period)) +
  geom_col() +
  geom_errorbar(aes(ymin = mean_data_score - stderr, ymax = mean_data_score + stderr), # specifying what the standard error is
                size=.3, # thinner lines
                width=.2) + # narrower bars
    theme_classic() +
    scale_fill_manual(values=c("#FF6666","#6699CC")) +
  scale_y_continuous(limits = c(0,21), expand = c(0,0)) + # getting the bars to start at the bottom of the graph
  easy_remove_legend() +
  easy_all_text_size(size = 8) + # change the size of the text
  easy_labs(x = "Time Period", y = "Mean Open Data Score") + # change the x and y labels
  ggtitle('(b)')

d2
```

### Interaction between time and subfield - Data scores 

```{r echo=FALSE}
data_subfieldtime_descriptives <- dates %>%
  group_by(subfield_groups, time_period) %>%
  summarise(mean_data_score = mean(total_data_score, na.rm = TRUE),
            SD = sd(total_data_score, na.rm = TRUE),
            N = n(),
            stderr = SD/sqrt(N))

data_subfieldtime_descriptives 

d3 <- data_subfieldtime_descriptives  %>%
  ggplot(aes(x = subfield_groups, y = mean_data_score, fill = time_period)) +
  geom_col(position = "dodge") +
  geom_errorbar(aes(ymin = mean_data_score - stderr, ymax = mean_data_score + stderr), # specifying what the standard error is
                size=.3, # thinner lines
                width=.2, # narrower bars
                position=position_dodge(.9)) + 
    theme_classic() +
    scale_fill_manual(values=c("#FF6666","#6699CC")) +
  scale_y_continuous(limits = c(0,25), expand = c(0,0)) + # getting the bars to start at the bottom of the graph
  easy_all_text_size(size = 9) + # change the size of the text
  easy_labs(x = "Subfield", y = "Mean Open Data Score") + # change the x and y labels
  theme(legend.title = element_blank()) + # remove legend title
  ggtitle('(c)')

(d1 | d2) / d3

```

## MATERIALS

### Subfield x Materials Score

```{r echo=FALSE}
materials_subfield_descriptives <- dates %>%
  group_by(subfield_groups) %>%
  summarise(mean_materials_score = mean(total_materials_score, na.rm = TRUE),
            SD = sd(total_materials_score, na.rm = TRUE),
            N = n(),
            stderr = SD/sqrt(N))

materials_subfield_descriptives

# let's plot this

m1 <- materials_subfield_descriptives %>%
  ggplot(aes(x = subfield_groups, y = mean_materials_score, fill = subfield_groups)) +
  geom_col() +
  geom_errorbar(aes(ymin = mean_materials_score - stderr, ymax = mean_materials_score + stderr), # specifying what the standard error is
                size=.3, # thinner lines
                width=.2) + # narrower bars
    theme_classic() +
    scale_fill_manual(values=c("#FF6666","#6699CC", "#FFCC33", "#00CC99")) +
  scale_y_continuous(limits = c(0,19), expand = c(0,0)) + # getting the bars to start at the bottom of the graph
  easy_remove_legend() +
  easy_all_text_size(size = 8) + # change the size of the text
  easy_labs(x = "Subfield", y = "Mean Open Materials Score") + # change the x and y labels
  ggtitle('(a)')

```

### Time Period x Materials Score

```{r echo=FALSE}
materials_timeperiod_descriptives <- dates %>%
  group_by(time_period) %>%
  summarise(mean_materials_score = mean(total_materials_score, na.rm = TRUE),
            SD = sd(total_materials_score, na.rm = TRUE),
            N = n(),
            stderr = SD/sqrt(N))

materials_timeperiod_descriptives

# let's plot this

m2 <- materials_timeperiod_descriptives %>%
  ggplot(aes(x = time_period, y = mean_materials_score, fill = time_period)) +
  geom_col() +
  geom_errorbar(aes(ymin = mean_materials_score - stderr, ymax = mean_materials_score + stderr), # specifying what the standard error is
                size=.3, # thinner lines
                width=.2) + # narrower bars
    theme_classic() +
    scale_fill_manual(values=c("#FF6666","#6699CC")) +
  scale_y_continuous(limits = c(0,19), expand = c(0,0)) + # getting the bars to start at the bottom of the graph
  easy_remove_legend() +
  easy_all_text_size(size = 8) + # change the size of the text
  easy_labs(x = "Time Period", y = "Mean Open Materials Score") + # change the x and y labels
  ggtitle('(b)')

```

### Interaction between time and subfield - Materials Score

```{r echo=FALSE}
materials_subfieldtime_descriptives <- dates %>%
  group_by(subfield_groups, time_period) %>%
  summarise(mean_materials_score = mean(total_materials_score, na.rm = TRUE),
            SD = sd(total_materials_score, na.rm = TRUE),
            N = n(),
            stderr = SD/sqrt(N))

materials_subfieldtime_descriptives

m3 <- materials_subfieldtime_descriptives  %>%
  ggplot(aes(x = subfield_groups, y = mean_materials_score, fill = time_period)) +
  geom_col(position = "dodge") +
  geom_errorbar(aes(ymin = mean_materials_score - stderr, ymax = mean_materials_score + stderr), # specifying what the standard error is
                size=.3, # thinner lines
                width=.2, # narrower bars
                position=position_dodge(.9)) + 
    theme_classic() +
    scale_fill_manual(values=c("#FF6666","#6699CC")) +
  scale_y_continuous(limits = c(0,19), expand = c(0,0)) + # getting the bars to start at the bottom of the graph
  easy_all_text_size(size = 9) + # change the size of the text
  easy_labs(x = "Subfield", y = "Mean Open Materials Score") + # change the x and y labels
    theme(legend.title = element_blank()) + # remove legend title
  ggtitle('(c)')

(m1 | m2) / m3

```

# SUBFIELD T-TESTS

## DATA

### Development vs. Cognition

An independent samples t-test showed that articles published in the field of Cognition generated higher Open Data Scores, on average, than articles published in the field of Developmental Psychology, 
```{r echo=FALSE}
devcog_data <- dates %>%
  filter(subfield_groups %in% c("Development", "Cognition"))

t_apa(t_test(total_data_score ~ subfield_groups, devcog_data, paired = FALSE))
```

### Development vs. Social

An independent samples t-test showed that articles published in the field of Social Psychology did not generate statistically significant different Open Data Scores, on average, than articles published in the field of Developmental Psychology, 
```{r echo=FALSE}
devsocial_data <- dates %>%
  filter(subfield_groups %in% c("Development", "Social"))

t_apa(t_test(total_data_score ~ subfield_groups, devsocial_data, paired = FALSE))
```

### Development vs. Other

An independent samples t-test showed that articles published in the Other subfield did not generate statistically significant different Open Data Scores, on average, than articles published in the field of Developmental Psychology, 
```{r echo=FALSE}
devother_data <- dates %>%
  filter(subfield_groups %in% c("Development", "Other"))

t_apa(t_test(total_data_score ~ subfield_groups, devother_data, paired = FALSE))
```

## MATERIAL

### Developmental vs. Cognition

An independent samples t-test showed that articles published in the field of Cognition generated higher Open Materials Scores, on average, than articles published in the field of Developmental Psychology, 
```{r echo=FALSE}
devcog_materials <- dates %>%
  filter(subfield_groups %in% c("Development", "Cognition"))

t_apa(t_test(total_materials_score ~ subfield_groups, devcog_materials, paired = FALSE))
```


### Developmental vs. Social

An independent samples t-test showed that articles published in the field of Social Psychology generated higher Open Materials Scores, on average, than articles published in the field of Developmental Psychology, 
```{r echo=FALSE}
devsocial_materials <- dates %>%
  filter(subfield_groups %in% c("Development", "Social"))

t_apa(t_test(total_materials_score ~ subfield_groups, devsocial_materials, paired = FALSE))
```

### Developmental vs. Other

An independent samples t-test showed that articles published in the Other subfield did not generate statistically significant different Open Materials Scores, on average, than articles published in the field of Developmental Psychology, 
```{r echo=FALSE}
devother_materials <- dates %>%
  filter(subfield_groups %in% c("Development", "Other"))

t_apa(t_test(total_materials_score ~ subfield_groups, devother_materials, paired = FALSE))
```
