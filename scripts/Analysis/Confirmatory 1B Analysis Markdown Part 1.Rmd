---
title: "Confirmatory 1B Analysis Markdown Part 1"
output:
  html_document: default
  word_document: default
---
# PREPARATION

## Load Packages
```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(janitor)
library(grid)
library(cowplot)
library(httr)
library(extrafont)
library(here)
library(ggeasy)
library(rstatix)
library(apa)
library(ez)
library(afex)
library(papaja)
library(patchwork)
library(jmv)
```

## Read in data
```{r message=FALSE, warning=FALSE, include=FALSE}
options(scipen=999) # remove scientific notation

data1B <- read_csv(here("data_files", "scored_master_dataset_1B.csv"))
```

## First factor: Subfield
```{r echo=FALSE}
# first, let's collapse the subfields into 4 main groups: developmental, cognition, social and 'other'
subfield_groups <- data1B %>%
  mutate(subfield_groups = case_when(subfield == "Behavioural Neuroscience" ~ "Other",
                                     subfield == "Cognitive Neuroscience" ~ "Other",
                                     subfield == "Health Psychology" ~ "Other",
                                     subfield == "Perception" ~ "Other",
                                     subfield == "Developmental Psychology" ~ "Development",
                                     subfield == "Social Psychology" ~  "Social",
                                     TRUE ~ as.character(subfield))) %>%
  relocate(subfield_groups, .after = subfield)

# we can now delete the original subfield column
subfield_groups <- subfield_groups %>%
  select(-subfield)

# Subfield summary

subfield_summary <- subfield_groups %>%
    count(subfield_groups) 

subfield_summary
```

## Second factor: Time 

```{r echo=FALSE}
dates <- subfield_groups %>%
  mutate(time_period = case_when(
    str_detect(article_id_number, "2019-30-7|2019-30-8|2019-30-9|2019-30-10|2019-30-11|2019-30-12") ~ "2nd half 2019",
    str_detect(article_id_number, "2020-31-1|2020-31-2|2020-31-3|2020-31-4|2020-31-5|2020-31-6") ~ "1st half 2020",
    str_detect(article_id_number, "2020-31-7|2020-31-8|2020-31-9|2020-31-10|2020-31-11|2020-31-12") ~ "2nd half 2020")) %>%
  relocate(time_period, .after = article_id_number)

# Timeperiod summary

timeperiod_summary <- dates %>%
  count(time_period)

timeperiod_summary

# Timeperiod and subfield summary

timeperiod_subfield_summary <- dates %>%
  tabyl(subfield_groups, time_period) 

timeperiod_subfield_summary
```

## Selecting only relevant data

```{r message=FALSE, include=FALSE}
final1B <- dates %>%
  select(article_id_number, subfield_groups, time_period, total_data_score, total_materials_score)

# make sure subfield and timeperiod are factors 

final1B$subfield_groups <- fct_relevel(final1B$subfield_groups, c("Development", "Social", "Cognition", "Other"))
final1B$time_period <- fct_relevel(final1B$time_period, c("2nd half 2019", "1st half 2020","2nd half 2020"))

# check data types

glimpse(final1B)

```

# DATA ANOVA Analysis 

```{r echo=FALSE}
# We decided to use Type II ANOVA tests because this appears to be the more conservative test out of Type I, II and III tests, and is most appropriate for our findings

data_ANOVA <- final1B %>%
  anova_test(total_data_score ~ subfield_groups * time_period)

data_ANOVA

```

Our two-way between-subjects ANOVA generated a significant main effect of subfield, F(`r data_ANOVA$DFn[1]`, `r data_ANOVA$DFd[1]`) = `r data_ANOVA$F[1]`, p = `r data_ANOVA$p[1]`, ges = `r data_ANOVA$ges[1]`, and time period, F(`r data_ANOVA$DFn[2]`, `r data_ANOVA$DFd[2]`) = `r data_ANOVA$F[2]`, p = `r data_ANOVA$p[2]`, ges = `r data_ANOVA$ges[2]`. However, the interaction between subfield and time period, F(`r data_ANOVA$DFn[3]`, `r data_ANOVA$DFd[3]`) = `r data_ANOVA$F[3]`, ges = `r data_ANOVA$ges[3]`, was not statistically significant.
  
```{r echo=FALSE}
# Alternatively we can use the papaja package to print the stats: 

data_aov <- aov_ez(
  data = final1B, dv = "total_data_score", 
  id = "article_id_number", 
  between = c("time_period", "subfield_groups"), 
  type = "2")

data_aov$anova_table

data_apa <- apa_print(data_aov)

apa_table(data_apa$table,
          caption = "Between-subjects ANOVA for Open Data Scores", 
          note = "This table was created with apa_table().")
```

Our two-way between-subjects ANOVA generated a significant main effect of time period, `r data_apa$full$time_period`, and a significant main effect of subfield, `r data_apa$full$subfield_groups`. However, the interaction between time period and subfield, `r data_apa$full$time_period_subfield_groups`, was not statistically significant. 



# MATERIALS ANOVA Analysis 

```{r echo=FALSE}
materials_ANOVA <- final1B %>%
  anova_test(total_materials_score ~ subfield_groups * time_period)

materials_ANOVA
```

Our two-way between-subjects ANOVA generated a significant main effect of subfield, F(`r materials_ANOVA$DFn[1]`, `r materials_ANOVA$DFd[1]`) = `r materials_ANOVA$F[1]`, p = `r materials_ANOVA$p[1]`, ges = `r materials_ANOVA$ges[1]`. However, the main effect of time period, F(`r materials_ANOVA$DFn[2]`, `r materials_ANOVA$DFd[2]`) = `r materials_ANOVA$F[2]`, p = `r materials_ANOVA$p[2]`, ges = `r materials_ANOVA$ges[2]`, and the interaction between subfield and time period, F(`r materials_ANOVA$DFn[3]`, `r materials_ANOVA$DFd[3]`) = `r materials_ANOVA$F[3]`, ges = `r materials_ANOVA$ges[3]`, were not statistically significant.
  
```{r echo=FALSE}
# Alternatively we can use the papaja package to print the stats: 

materials_aov <- aov_ez(
  data = final1B, dv = "total_materials_score", 
  id = "article_id_number", 
  between = c("time_period", "subfield_groups"), 
  type = "2")

materials_aov$anova_table

materials_apa <- apa_print(materials_aov)

apa_table(materials_apa$table,
          caption = "Between-subjects ANOVA for Open Materials Scores", 
          note = "This table was created with apa_table().")
```

Our two-way between-subjects ANOVA generated a significant main effect of subfield, `r materials_apa$full$subfield_groups`, however the main effect of time period, `r materials_apa$full$time_period`, and the interaction between time period and subfield, `r materials_apa$full$time_period_subfield_groups`, were not statistically significant. 


# PLOTS

## DATA

### Subfield x Data Score

```{r echo=FALSE}
data_subfield_descriptives <- final1B %>%
  group_by(subfield_groups) %>%
  summarise(mean_data_score = mean(total_data_score, na.rm = TRUE),
            SD = sd(total_data_score, na.rm = TRUE),
            N = n(),
            stderr = SD/sqrt(N))

data_subfield_descriptives$subfield_groups <- fct_relevel(data_subfield_descriptives$subfield_groups, c("Development", "Social", "Cognition", "Other"))

data_subfield_descriptives

# let's plot this

d1 <- data_subfield_descriptives %>%
  ggplot(aes(x = subfield_groups, y = mean_data_score, fill = subfield_groups)) +
  geom_col() +
  geom_errorbar(aes(ymin = mean_data_score - stderr, ymax = mean_data_score + stderr), # specifying what the standard error is
                size=.3, # thinner lines
                width=.2) + # narrower bars
    theme_classic() +
    scale_fill_manual(values=c("#EC407A","#42A5F5", "#FFCC33", "#00CC99")) +
  scale_y_continuous(limits = c(0,25), expand = c(0,0)) + # getting the bars to start at the bottom of the graph
  easy_remove_legend() +
  easy_all_text_size(size = 8) + # change the size of the text
  easy_labs(x = "Subfield", y = "Mean Open Data Score") + # change the x and y labels
  ggtitle('(a)')

```

### Time Period x Data Score

```{r echo=FALSE}
data_timeperiod_descriptives <- final1B %>%
  group_by(time_period) %>%
  summarise(mean_data_score = mean(total_data_score, na.rm = TRUE),
            SD = sd(total_data_score, na.rm = TRUE),
            N = n(),
            stderr = SD/sqrt(N))

data_timeperiod_descriptives

# let's plot this

d2 <- data_timeperiod_descriptives %>%
  ggplot(aes(x = time_period, y = mean_data_score, fill = time_period)) +
  geom_col() +
  geom_errorbar(aes(ymin = mean_data_score - stderr, ymax = mean_data_score + stderr), # specifying what the standard error is
                size=.3, # thinner lines
                width=.2) + # narrower bars
    theme_classic() +
    scale_fill_manual(values=c("#FFCCCC","#FF9999", "#FF6666")) +
  scale_y_continuous(limits = c(0,21), expand = c(0,0)) + # getting the bars to start at the bottom of the graph
  easy_remove_legend() +
  easy_all_text_size(size = 8) + # change the size of the text
  easy_labs(x = "Time Period", y = "Mean Open Data Score") + # change the x and y labels
  ggtitle('(b)')
```

### Interaction between time and subfield - Data scores 

```{r echo=FALSE}
data_subfieldtime_descriptives <- final1B %>%
  group_by(subfield_groups, time_period) %>%
  summarise(mean_data_score = mean(total_data_score, na.rm = TRUE),
            SD = sd(total_data_score, na.rm = TRUE),
            N = n(),
            stderr = SD/sqrt(N))

d3 <- data_subfieldtime_descriptives  %>%
  ggplot(aes(x = subfield_groups, y = mean_data_score, fill = time_period)) +
  geom_col(position = "dodge") +
  geom_errorbar(aes(ymin = mean_data_score - stderr, ymax = mean_data_score + stderr), # specifying what the standard error is
                size=.3, # thinner lines
                width=.2, # narrower bars
                position=position_dodge(.9)) + 
    theme_classic() +
    scale_fill_manual(values=c("#FFCCCC","#FF9999", "#FF6666")) +
  scale_y_continuous(limits = c(0,25), expand = c(0,0)) + # getting the bars to start at the bottom of the graph
  easy_all_text_size(size = 9) + # change the size of the text
  easy_labs(x = "Subfield", y = "Mean Open Data Score") + # change the x and y labels
  theme(legend.title = element_blank()) + # remove legend title
  ggtitle('(c)')

(d1 | d2) / d3

```

## MATERIALS

### Subfield x Materials Score

```{r echo=FALSE}
materials_subfield_descriptives <- final1B %>%
  group_by(subfield_groups) %>%
  summarise(mean_materials_score = mean(total_materials_score, na.rm = TRUE),
            SD = sd(total_data_score, na.rm = TRUE),
            N = n(),
            stderr = SD/sqrt(N))

materials_subfield_descriptives

# let's plot this

m1 <- materials_subfield_descriptives %>%
  ggplot(aes(x = subfield_groups, y = mean_materials_score, fill = subfield_groups)) +
  geom_col() +
  geom_errorbar(aes(ymin = mean_materials_score - stderr, ymax = mean_materials_score + stderr), # specifying what the standard error is
                size=.3, # thinner lines
                width=.2) + # narrower bars
    theme_classic() +
    scale_fill_manual(values=c("#EC407A","#42A5F5", "#FFCC33", "#00CC99")) +
  scale_y_continuous(limits = c(0,19), expand = c(0,0)) + # getting the bars to start at the bottom of the graph
  easy_remove_legend() +
  easy_all_text_size(size = 8) + # change the size of the text
  easy_labs(x = "Subfield", y = "Mean Open Materials Score") + # change the x and y labels
  ggtitle('(a)')

```

### Time Period x Materials Score

```{r echo=FALSE}
materials_timeperiod_descriptives <- final1B %>%
  group_by(time_period) %>%
  summarise(mean_materials_score = mean(total_materials_score, na.rm = TRUE),
            SD = sd(total_materials_score, na.rm = TRUE),
            N = n(),
            stderr = SD/sqrt(N))

materials_timeperiod_descriptives

# let's plot this

m2 <- materials_timeperiod_descriptives %>%
  ggplot(aes(x = time_period, y = mean_materials_score, fill = time_period)) +
  geom_col() +
  geom_errorbar(aes(ymin = mean_materials_score - stderr, ymax = mean_materials_score + stderr), # specifying what the standard error is
                size=.3, # thinner lines
                width=.2) + # narrower bars
    theme_classic() +
    scale_fill_manual(values=c("#FFCCCC","#FF9999", "#FF6666")) +
  scale_y_continuous(limits = c(0,19), expand = c(0,0)) + # getting the bars to start at the bottom of the graph
  easy_remove_legend() +
  easy_all_text_size(size = 8) + # change the size of the text
  easy_labs(x = "Time Period", y = "Mean Open Materials Score") + # change the x and y labels
  ggtitle('(b)')

```

### Interaction between time and subfield - Materials Score

```{r echo=FALSE}
materials_subfieldtime_descriptives <- final1B %>%
  group_by(subfield_groups, time_period) %>%
  summarise(mean_materials_score = mean(total_materials_score, na.rm = TRUE),
            SD = sd(total_materials_score, na.rm = TRUE),
            N = n(),
            stderr = SD/sqrt(N))

materials_subfieldtime_descriptives

m3 <- materials_subfieldtime_descriptives  %>%
  ggplot(aes(x = subfield_groups, y = mean_materials_score, fill = time_period)) +
  geom_col(position = "dodge") +
  geom_errorbar(aes(ymin = mean_materials_score - stderr, ymax = mean_materials_score + stderr), # specifying what the standard error is
                size=.3, # thinner lines
                width=.2, # narrower bars
                position=position_dodge(.9)) + 
    theme_classic() +
    scale_fill_manual(values=c("#FFCCCC","#FF9999", "#FF6666")) +
  scale_y_continuous(limits = c(0,19), expand = c(0,0)) + # getting the bars to start at the bottom of the graph
  easy_all_text_size(size = 9) + # change the size of the text
  easy_labs(x = "Subfield", y = "Mean Open Materials Score") + # change the x and y labels
   theme(legend.title = element_blank()) + # remove legend title
  ggtitle('(c)')

(m1 | m2) / m3

```

# SUBFIELD T-TESTS

## DATA

### Development vs. Cognition

An independent samples t-test showed that articles published in the field of Cognition generated higher Open Data Scores, on average, than articles published in the field of Developmental Psychology, 
```{r echo=FALSE}
devcog_data <- final1B %>%
  filter(subfield_groups %in% c("Development", "Cognition"))

t_test(total_data_score ~ subfield_groups, devcog_data, paired = FALSE)

t_apa(t_test(total_data_score ~ subfield_groups, devcog_data, paired = FALSE))
```

### Development vs. Social

An independent samples t-test showed that articles published in the field of Social Psychology did not generate statistically different Open Data Scores, on average, than articles published in the field of Developmental Psychology,
```{r echo=FALSE}
devsocial_data <- final1B %>%
  filter(subfield_groups %in% c("Development", "Social"))

t_apa(t_test(total_data_score ~ subfield_groups, devsocial_data, paired = FALSE))
```

### Development vs. Other

An independent samples t-test showed that articles published in the Other subfield did not generate statistically different Open Data Scores, on average, than articles published in the field of Developmental Psychology,
```{r echo=FALSE}
devother_data <- final1B %>%
  filter(subfield_groups %in% c("Development", "Other"))

t_apa(t_test(total_data_score ~ subfield_groups, devother_data, paired = FALSE))
```

## MATERIAL

### Developmental vs. Cognition

An independent samples t-test showed that articles published in the field of Cognition generated higher Open Materials Scores, on average, than articles published in the field of Developmental Psychology, 
```{r echo=FALSE}
devcog_materials <- final1B %>%
  filter(subfield_groups %in% c("Development", "Cognition"))

t_apa(t_test(total_materials_score ~ subfield_groups, devcog_materials, paired = FALSE))
```

### Developmental vs. Social

An independent samples t-test showed that articles published in the field of Social Psychology did not generate statistically different Open Materials Scores, on average, than articles published in the field of Developmental Psychology,
```{r echo=FALSE}
devsocial_materials <- final1B %>%
  filter(subfield_groups %in% c("Development", "Social"))

t_apa(t_test(total_materials_score ~ subfield_groups, devsocial_materials, paired = FALSE))
```

### Developmental vs. Other

An independent samples t-test showed that articles published in the Other subfield did not generate statistically different Open Materials Scores, on average, than articles published in the field of Developmental Psychology,
```{r echo=FALSE}
devother_materials <- final1B %>%
  filter(subfield_groups %in% c("Development", "Other"))

t_apa(t_test(total_materials_score ~ subfield_groups, devother_materials, paired = FALSE))
```

# TIME T-TESTS

## DATA

### Second half 2019 vs. First half 2020

An independent samples t-test showed that articles published in the first half of 2020 generated significantly higher Open Data Scores, on average, than articles published in the second half of 2019,
```{r echo=FALSE}
second2019_first2020 <- final1B %>%
  filter(time_period %in% c("2nd half 2019", "1st half 2020"))

t_apa(t_test(total_data_score ~ time_period, second2019_first2020, paired = FALSE))
```

### First half 2020 vs. Second half 2020

An independent samples t-test showed that articles published in the second half of 2020 did not generate significantly higher Open Data Scores than articles published in the first half of 2020, 
```{r echo=FALSE}
first2020_second2020 <- final1B %>%
  filter(time_period %in% c("1st half 2020", "2nd half 2020"))

t_apa(t_test(total_data_score ~ time_period, first2020_second2020, paired = FALSE))
```

## MATERIALS

There time period main effect for Open Materials Scores was not statistically significant, so no t-tests to run here
